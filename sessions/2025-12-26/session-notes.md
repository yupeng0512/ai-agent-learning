# Session: 2025-12-26

## ä¸»é¢˜ï¼šRAG åŸºç¡€ä¸é«˜çº§ Agent æ¶æ„

### ä»Šæ—¥å­¦ä¹ ç›®æ ‡
- ç†è§£ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰çš„åŸç†å’Œå®ç°
- æŒæ¡ Agent + RAG çš„ç»“åˆæ–¹å¼
- å­¦ä¹ é«˜çº§ Agent æ¶æ„ï¼ˆå¹¶è¡Œæ‰§è¡Œã€A2A åè®®ï¼‰

---

## ä¸€ã€RAG åŸºç¡€

### ä»€ä¹ˆæ˜¯ RAGï¼Ÿ

**RAG = Retrieval-Augmented Generationï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰**

è§£å†³ LLM çš„æ ¸å¿ƒé—®é¢˜ï¼š
- çŸ¥è¯†æˆªæ­¢æ—¥æœŸï¼ˆä¸çŸ¥é“æœ€æ–°ä¿¡æ¯ï¼‰
- å¹»è§‰ï¼ˆç¼–é€ ä¸å­˜åœ¨çš„å†…å®¹ï¼‰
- ç§æœ‰çŸ¥è¯†ï¼ˆä¸çŸ¥é“ä¼ä¸šå†…éƒ¨æ–‡æ¡£ï¼‰

### RAG å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¦»çº¿é˜¶æ®µï¼šæ„å»ºçŸ¥è¯†åº“                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  æ–‡æ¡£ â†’ åˆ‡åˆ† â†’ Embedding â†’ å­˜å…¥å‘é‡æ•°æ®åº“                  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ PDF  â”‚ â†’ â”‚Chunksâ”‚ â†’ â”‚ Vectors  â”‚ â†’ â”‚ FAISS/     â”‚       â”‚
â”‚  â”‚ TXT  â”‚   â”‚      â”‚   â”‚ [0.1,...]â”‚   â”‚ Chroma/... â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åœ¨çº¿é˜¶æ®µï¼šæ£€ç´¢ + ç”Ÿæˆ                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ç”¨æˆ·é—®é¢˜ â†’ Embedding â†’ å‘é‡æœç´¢ â†’ ç›¸å…³æ–‡æ¡£ â†’ LLM â†’ å›ç­”   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Embedding åŸç†

**å‘é‡æœç´¢ vs å…³é”®è¯æœç´¢**

| æœç´¢ç±»å‹ | åŸç† | ä¼˜åŠ¿ | åŠ£åŠ¿ |
|---------|------|------|------|
| å…³é”®è¯æœç´¢ | ç²¾ç¡®åŒ¹é…è¯æ±‡ | å¿«é€Ÿã€ç²¾ç¡® | æ— æ³•ç†è§£è¯­ä¹‰ |
| å‘é‡æœç´¢ | è¯­ä¹‰ç›¸ä¼¼åº¦ | ç†è§£åŒä¹‰è¯ã€ä¸Šä¸‹æ–‡ | éœ€è¦ Embedding æ¨¡å‹ |

ç¤ºä¾‹ï¼š
```
æŸ¥è¯¢ï¼š"å¦‚ä½•æé«˜ä»£ç è´¨é‡"

å…³é”®è¯æœç´¢ï¼šåªèƒ½æ‰¾åˆ°åŒ…å«"ä»£ç è´¨é‡"çš„æ–‡æ¡£
å‘é‡æœç´¢ï¼šèƒ½æ‰¾åˆ°"ä»£ç å®¡æŸ¥"ã€"å•å…ƒæµ‹è¯•"ã€"é‡æ„"ç­‰è¯­ä¹‰ç›¸å…³çš„æ–‡æ¡£
```

### æ–‡æ¡£åˆ‡åˆ†ç­–ç•¥

```python
# å…³é”®å‚æ•°
chunk_size = 500      # æ¯å—å¤§å°
chunk_overlap = 50    # é‡å éƒ¨åˆ†ï¼ˆä¿æŒä¸Šä¸‹æ–‡è¿è´¯ï¼‰

# åˆ‡åˆ†æ–¹å¼
- RecursiveCharacterTextSplitterï¼ˆæ¨èï¼‰ï¼šæŒ‰æ®µè½ã€å¥å­ã€å­—ç¬¦é€’å½’åˆ‡åˆ†
- CharacterTextSplitterï¼šç®€å•æŒ‰å­—ç¬¦åˆ‡åˆ†
- TokenTextSplitterï¼šæŒ‰ Token åˆ‡åˆ†
```

### å®ç°ä»£ç è¦ç‚¹

```python
# 1. Embedding æ¨¡å‹ï¼ˆä½¿ç”¨ SiliconFlow çš„ bge-m3ï¼‰
from langchain_openai import OpenAIEmbeddings
embeddings = OpenAIEmbeddings(
    model="BAAI/bge-m3",
    openai_api_key=SILICONFLOW_API_KEY,
    openai_api_base=SILICONFLOW_BASE_URL,
)

# 2. å‘é‡æ•°æ®åº“ï¼ˆFAISSï¼‰
from langchain_community.vectorstores import FAISS
vectorstore = FAISS.from_documents(docs, embeddings)

# 3. RAG Chain
from langchain.chains import RetrievalQA
qa_chain = RetrievalQA.from_chain_type(
    llm=llm,
    retriever=vectorstore.as_retriever(search_kwargs={"k": 3}),
)
```

---

## äºŒã€Agent + RAG ç»“åˆ

### ä¸ºä»€ä¹ˆè¦ç»“åˆï¼Ÿ

| å•ç‹¬ä½¿ç”¨ | é—®é¢˜ |
|---------|------|
| åªç”¨ RAG | æ¯æ¬¡éƒ½æ£€ç´¢ï¼Œå³ä½¿é—®é¢˜ä¸éœ€è¦ |
| åªç”¨ Agent | æ— æ³•è®¿é—®ç§æœ‰çŸ¥è¯†åº“ |

**ç»“åˆå**ï¼šAgent è‡ªä¸»å†³å®šä½•æ—¶éœ€è¦æ£€ç´¢

### å®ç°æ–¹å¼ï¼šRAG å°è£…ä¸º Tool

```python
@tool
def search_knowledge_base(query: str) -> str:
    """æœç´¢çŸ¥è¯†åº“è·å–ç›¸å…³ä¿¡æ¯ã€‚å½“éœ€è¦æŸ¥è¯¢å…¬å¸å†…éƒ¨æ–‡æ¡£æ—¶ä½¿ç”¨ã€‚"""
    docs = retriever.invoke(query)
    return "\n".join([doc.page_content for doc in docs])

# Agent ä¼šæ ¹æ®é—®é¢˜è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦è°ƒç”¨
tools = [search_knowledge_base, calculator, web_search]
agent = create_react_agent(llm, tools, prompt)
```

### å¤šå·¥å…·åä½œç¤ºä¾‹

```
ç”¨æˆ·ï¼š"æ ¹æ®çŸ¥è¯†åº“è®¡ç®—é¡¹ç›®é¢„ç®—"

Agent æ€è€ƒï¼š
1. éœ€è¦å…ˆä»çŸ¥è¯†åº“è·å–é¡¹ç›®ä¿¡æ¯ â†’ è°ƒç”¨ search_knowledge_base
2. è·å–åˆ°æ•°æ®åéœ€è¦è®¡ç®— â†’ è°ƒç”¨ calculator
3. æ•´åˆç»“æœå›ç­”ç”¨æˆ·
```

---

## ä¸‰ã€é«˜çº§ Agent æ¶æ„

### æ¶æ„å¯¹æ¯”

| æ¶æ„ | æ ¸å¿ƒæ€æƒ³ | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|
| ReAct | è¾¹æƒ³è¾¹åš | ç®€å•ä»»åŠ¡ï¼ˆ1-3æ­¥ï¼‰ |
| Plan-and-Execute | å…ˆè§„åˆ’åæ‰§è¡Œ | å¤æ‚å¤šæ­¥éª¤ä»»åŠ¡ |
| Multi-Agent | ä¸“ä¸šåˆ†å·¥ | éœ€è¦å¤šç§èƒ½åŠ›åä½œ |

### LangGraph å®ç°

```python
from langgraph.graph import StateGraph, END

# å®šä¹‰çŠ¶æ€
class AgentState(TypedDict):
    task: str
    research_result: str
    draft: str
    review: str

# æ„å»ºå›¾
workflow = StateGraph(AgentState)
workflow.add_node("researcher", researcher_node)
workflow.add_node("writer", writer_node)
workflow.add_node("reviewer", reviewer_node)

# ä¸²è¡Œæ‰§è¡Œ
workflow.set_entry_point("researcher")
workflow.add_edge("researcher", "writer")
workflow.add_edge("writer", "reviewer")
workflow.add_edge("reviewer", END)
```

### å¹¶è¡Œæ‰§è¡Œ

```
ä¸²è¡Œï¼šA(3s) â†’ B(3s) â†’ C(3s) = 9s
å¹¶è¡Œï¼šA(3s) + B(3s) + C(3s) = 3sï¼ˆåŒæ—¶æ‰§è¡Œï¼‰

æ¶æ„å›¾ï¼š
                â”Œâ†’ ğŸ”¬ æŠ€æœ¯ç ”ç©¶å‘˜ â”€â”
                â”‚                  â”‚
START â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â†’ ğŸ“Š å¸‚åœºç ”ç©¶å‘˜ â”€â”¼â†’ ğŸ“ æ±‡æ€» â†’ END
                â”‚                  â”‚
                â””â†’ ğŸ” ç«å“ç ”ç©¶å‘˜ â”€â”˜
```

å®æµ‹æ•ˆæœï¼šä¸‰ä¸ªç ”ç©¶å‘˜å¹¶è¡Œï¼Œæ€»è€—æ—¶ 4.2sï¼ˆä¸²è¡Œéœ€è¦ ~10sï¼‰

---

## å››ã€A2A åè®®

### ä»€ä¹ˆæ˜¯ A2Aï¼Ÿ

**A2A (Agent-to-Agent)** æ˜¯ Google äº 2025 å¹´ 4 æœˆæå‡ºçš„å¼€æ”¾åè®®ï¼Œå®šä¹‰äº†ä¸åŒ Agent ç³»ç»Ÿä¹‹é—´å¦‚ä½•é€šä¿¡å’Œåä½œã€‚

### A2A vs Multi-Agent

| æ¦‚å¿µ | ç±»å‹ | è§£å†³ä»€ä¹ˆé—®é¢˜ |
|------|------|-------------|
| Multi-Agent | æ¶æ„æ¨¡å¼ | åŒä¸€ç³»ç»Ÿå†…å¤š Agent å¦‚ä½•åä½œ |
| A2A | é€šä¿¡åè®® | è·¨ç³»ç»Ÿ Agent å¦‚ä½•äº’ç›¸å‘ç°å’Œé€šä¿¡ |

### ä¸‰å¤§åè®®å¯¹æ¯”

| åè®® | è§£å†³ä»€ä¹ˆé—®é¢˜ | ç±»æ¯” |
|------|-------------|------|
| MCP | Agent è°ƒç”¨å·¥å…· | USB æ¥å£æ ‡å‡† |
| A2A | Agent ä¹‹é—´é€šä¿¡ | HTTP åè®® |
| Function Calling | LLM è°ƒç”¨å‡½æ•° | API è°ƒç”¨ |

### A2A æ ¸å¿ƒæ¦‚å¿µ

1. **Agent Card**ï¼šAgent åç‰‡ï¼Œæè¿°èƒ½åŠ›å’Œæ¥å£
2. **Task**ï¼šAgent ä¹‹é—´ä¼ é€’çš„å·¥ä½œå•å…ƒ
3. **Message**ï¼šé€šä¿¡å†…å®¹
4. **Artifact**ï¼šä»»åŠ¡æ‰§è¡Œçš„è¾“å‡ºç»“æœ

### ä¸¤è€…äº’è¡¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  A2A   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ Agent A â”‚ â†â”€â”€â”€â”€â†’ â”‚ Agent B â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                    â”‚
â”‚       â”‚ MCP              â”‚ MCP                      â”‚
â”‚       â–¼                  â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ å·¥å…·é›†  â”‚        â”‚ å·¥å…·é›†  â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€ä»Šæ—¥ä»£ç äº§å‡º

| æ–‡ä»¶ | å†…å®¹ |
|------|------|
| `05_rag_basics.py` | RAG åŸºç¡€æ•™ç¨‹ï¼ˆEmbeddingã€å‘é‡æœç´¢ã€æ–‡æ¡£åˆ‡åˆ†ï¼‰ |
| `06_agent_with_rag.py` | Agent + RAG ç»“åˆï¼ˆRAG ä½œä¸º Toolï¼‰ |
| `07_advanced_agent_patterns.py` | é«˜çº§æ¶æ„ï¼ˆMulti-Agentã€å¹¶è¡Œã€A2Aï¼‰ |
| `.env.example` | æ–°å¢ SiliconFlow API é…ç½® |

---

## å…­ã€é¢è¯•è¦ç‚¹

### RAG ç›¸å…³

**Q: RAG è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ**
A: è§£å†³ LLM çš„çŸ¥è¯†æˆªæ­¢ã€å¹»è§‰ã€ç§æœ‰çŸ¥è¯†ä¸‰å¤§é—®é¢˜

**Q: å‘é‡æœç´¢å’Œå…³é”®è¯æœç´¢çš„åŒºåˆ«ï¼Ÿ**
A: å…³é”®è¯æ˜¯ç²¾ç¡®åŒ¹é…ï¼Œå‘é‡æ˜¯è¯­ä¹‰åŒ¹é…ï¼Œèƒ½ç†è§£åŒä¹‰è¯å’Œä¸Šä¸‹æ–‡

**Q: æ–‡æ¡£åˆ‡åˆ†çš„å…³é”®å‚æ•°ï¼Ÿ**
A: chunk_sizeï¼ˆå—å¤§å°ï¼‰å’Œ chunk_overlapï¼ˆé‡å ï¼‰ï¼Œéœ€è¦å¹³è¡¡å®Œæ•´æ€§å’Œæ£€ç´¢ç²¾åº¦

### Agent æ¶æ„ç›¸å…³

**Q: ReAct å’Œ Plan-and-Execute çš„åŒºåˆ«ï¼Ÿ**
A: ReAct è¾¹æƒ³è¾¹åšé€‚åˆç®€å•ä»»åŠ¡ï¼ŒPlan-Execute å…ˆè§„åˆ’åæ‰§è¡Œé€‚åˆå¤æ‚ä»»åŠ¡

**Q: A2A å’Œ MCP æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**
A: MCP æ˜¯ Agentâ†’Toolï¼ˆè°ƒç”¨å·¥å…·ï¼‰ï¼ŒA2A æ˜¯ Agentâ†”Agentï¼ˆè·¨ç³»ç»Ÿé€šä¿¡ï¼‰

**Q: ä»€ä¹ˆæ—¶å€™ç”¨å¹¶è¡Œæ‰§è¡Œï¼Ÿ**
A: å½“å¤šä¸ªä»»åŠ¡ç›¸äº’ç‹¬ç«‹ã€æ²¡æœ‰ä¾èµ–å…³ç³»æ—¶ï¼Œå¯ä»¥å¹¶è¡Œæé«˜æ•ˆç‡

---

## ä¸ƒã€å­¦ä¹ æ”¶è·

1. **RAG æ˜¯ Agent çš„"å¤–éƒ¨å¤§è„‘"**ï¼šè®© Agent èƒ½è®¿é—®ç§æœ‰çŸ¥è¯†
2. **æ¶æ„ç»„åˆæ˜¯å…³é”®**ï¼šä¸²è¡Œ/å¹¶è¡Œã€å•Agent/å¤šAgent æ ¹æ®åœºæ™¯é€‰æ‹©
3. **åè®®ç”Ÿæ€åœ¨å½¢æˆ**ï¼šMCPï¼ˆå·¥å…·ï¼‰+ A2Aï¼ˆé€šä¿¡ï¼‰æ„å»º Agent äº’æ“ä½œåŸºç¡€
4. **å·¥ç¨‹å®è·µ**ï¼šEmbedding é€‰å‹ã€å‘é‡åº“é€‰å‹ã€åˆ‡åˆ†ç­–ç•¥éƒ½å½±å“æ•ˆæœ

---

## å…«ã€è¯¾ç¨‹è¿›åº¦

```
âœ… 01 - LangChain åŸºç¡€
âœ… 02 - Tools & Agents
âœ… 03 - Tool Prompt æ£€æŸ¥
âœ… 04 - Memory
âœ… 05 - RAG åŸºç¡€
âœ… 06 - Agent + RAG
âœ… 07 - é«˜çº§ Agent æ¶æ„

ğŸ“Œ ä¸‹ä¸€æ­¥å¯é€‰ï¼š
   08 - Agent è¯„ä¼°ä¸ä¼˜åŒ–
   09 - ç”Ÿäº§éƒ¨ç½²å®è·µ
   10 - ç»¼åˆé¡¹ç›®å®æˆ˜
```

---

*Session æ—¶é•¿: ~3å°æ—¶*
*å­¦ä¹ çŠ¶æ€: é«˜æ•ˆ*
